let graph=new joint.dia.Graph,variables=[];const globalEval=eval,disabledBlocks=["start","end","circle"];let currentContextName="main";const paperColumn=$("#paperColumn");let paper=new joint.dia.Paper({el:document.getElementById("myHolder"),height:paperColumn.height(),width:paperColumn.width(),model:graph,gridSize:1});paper.on("element:pointerdblclick",(function(e){const t=findModel(e.model.id).attr("element/type");disabledBlocks.includes(t)||handleElementDoubleClick(e)})),graph.on("change:position",(function(){paper.fitToContent({padding:20,minWidth:paperColumn.width(),minHeight:paperColumn.height(),gridWidth:10,gridHeight:10})}));let start=addStartAndEndBlock(currentContextName),contexts={main:{graph:graph.toJSON(),start:start}};function getParametersAndReturnType(e){if("main"!==e){const a=getCurrentContexts()[e];var t="";a.parameters.length>0&&(a.parameters.forEach(e=>{t+=e.variableType+" "+e.variableName+","}),t=t.slice(0,t.length-1));const r=a.returnType?`return ${a.returnType} ${e}()`:`return void ${e}()`;var n={parameters:t,returnType:r}}else n={parameters:"",returnType:`End ${e}()`};return n}function switchContext(){contexts[currentContextName]={...contexts[currentContextName]||{},graph:graph.toJSON()},currentContextName=$("#currentContext").val();const e=contexts[currentContextName];e.graph?graph.fromJSON(e.graph):(graph.fromJSON((new joint.dia.Graph).toJSON()),start=addStartAndEndBlock(currentContextName),contexts[currentContextName]={...contexts[currentContextName]||{},start:start,graph:graph.toJSON()}),paper.fitToContent({padding:20,minWidth:paperColumn.width(),minHeight:paperColumn.height(),gridWidth:10,gridHeight:10})}function updateCurrentContexts(e){for(context in e&&e.main&&delete e.main,contexts={main:contexts.main,...e||{}},contexts[currentContextName].graph=graph.toJSON(),e)if(e[context].graph){const e=getParametersAndReturnType(context);contexts[context].graph.cells[0].attrs.label.text=getWrapText(`Start ${context}(${e.parameters})`),contexts[context].graph.cells[1].attrs.label.text=getWrapText(e.returnType)}graph.fromJSON(contexts[currentContextName].graph)}function getCurrentContexts(){const e={...contexts};return delete e.main,e}function addNewContext(e){contexts={...contexts,...e}}function updateContextsDropdown(){$("#currentContext option").remove();const e=$("#currentContext");Object.keys(contexts).forEach(t=>{e.append($("<option />").val(t).text(t))}),e.val(currentContextName)}function addStartAndEndBlock(e){const t=new joint.shapes.standard.Link,n=getParametersAndReturnType(e);let a=new joint.shapes.standard.Rectangle;a.position(350,30),a.resize(150,60),a.attr({element:{type:"start"},outgoing_link:{next:t.id},body:{fill:"#E74C3C",rx:20,ry:20,strokeWidth:0},label:{text:getWrapText(`Start ${e}(${n.parameters})`),fill:"#ECF0F1"}}),a.addTo(graph);const r=a.clone();return r.attr({label:{text:getWrapText(n.returnType)},element:{type:"end"},outgoing_link:null}),r.translate(0,100),r.addTo(graph),t.source(a),t.target(r),t.addTo(graph),t.attr({element:{source:a.id,target:r.id}}),a}updateContextsDropdown(),window.onload=()=>{"use strict";"localhost"!==location.hostname&&"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js")};const blockColors={input:"#ffadad",output:"#caffbf",assignment:"#fdffb6",declaration:"#ffd6a5",while:"#9bf6ff",for:"#a0c4ff",doWhile:"#bdb2ff",if:"#ffc6ff",function:"#e0fbfc",comment:"#ffffff"};let doubleClickedLink,code;function handleDoubleClick(e){if(["whileFalse","doWhileTrue"].includes(e.model.attr("element/type")))return;const t=e.model.id;doubleClickedLink=findModel(t);let n=new joint.dia.Graph;const a=$("#modal .modal-body");new joint.dia.Paper({el:a,height:a.height,width:a.width,model:n,gridSize:1,interactive:!1}).on("element:pointerclick",(function(e){$("#modal .modal-content").removeClass("modal-height"),$(".joint-element").removeClass("cursor-click"),$("#modal").modal("hide");({OUTPUT:addOutput,INPUT:addInput,WHILE:addWhile,FOR:addForLoop,"DO-WHILE":addDoWhileLoop,ASSIGNMENT:addAssignment,DECLARATION:addDeclaration,IF:addIF,FUNCTION:addFunction,COMMENT:addComment})[e.model.attr("label/text")]()})),populateAvailableElements(n),$("#modal .modal-content").addClass("modal-height"),$("#delbtn").text("Close").attr("data-dismiss","modal").on("click",(function(e){$("#modal .modal-content").removeClass("modal-height")})).removeAttr("onclick"),$("#xbtn").on("click",(function(e){$("#modal .modal-content").removeClass("modal-height")})),$(".joint-element").addClass("cursor-click"),$("#modal").modal("show")}function populateAvailableElements(e){const t=getParallelogram();t.position(20,20),t.resize(120,63),t.attr({label:{text:"OUTPUT"},body:{fill:blockColors.output}}),t.addTo(e);const n=getParallelogram();n.resize(120,63),n.position(t.position().x+124,t.position().y),n.attr({label:{text:"INPUT"},body:{fill:blockColors.input}}),n.addTo(e);const a=getRectangle();a.resize(115,63),a.position(t.position().x,t.position().y+90),a.attr({label:{text:"ASSIGNMENT"},body:{fill:blockColors.assignment}}),a.addTo(e);const r=getRectangle();r.resize(115,63),r.position(a.position().x+130,a.position().y),r.attr({label:{text:"DECLARATION"},body:{fill:blockColors.declaration}}),r.addTo(e);const i=getHexagon();i.resize(115,63),i.position(a.position().x,a.position().y+90),i.attr({label:{text:"WHILE"},body:{fill:blockColors.while}}),i.addTo(e);const l=getHexagon();l.resize(115,63),l.position(i.position().x+130,i.position().y),l.attr({label:{text:"FOR"},body:{fill:blockColors.for}}),l.addTo(e);const o=getHexagon();o.resize(115,63),o.position(i.position().x,i.position().y+90),o.attr({label:{text:"DO-WHILE"},body:{fill:blockColors.doWhile}}),o.addTo(e);const s=getDiamond();s.resize(115,63),s.position(o.position().x+130,o.position().y),s.attr({label:{text:"IF"},body:{fill:blockColors.if}}),s.addTo(e);const d=getRectangle();d.resize(115,63),d.position(o.position().x,o.position().y+90),d.attr({label:{text:"FUNCTION"},body:{fill:blockColors.function}}),d.addTo(e);const c=getRectangle();c.resize(115,63),c.position(d.position().x+130,d.position().y),c.attr({label:{text:"COMMENT"},body:{fill:blockColors.comment,strokeWidth:1,stroke:"#959595",strokeDasharray:"2,2"}}),c.addTo(e)}function addOutput(){const e=getParallelogram();e.attr({label:{text:getWrapText("output")},body:{fill:blockColors.output}}),e.addTo(graph),addElement(doubleClickedLink,e,"output")}function addInput(){const e=getParallelogram();e.attr({label:{text:getWrapText("input")},body:{fill:blockColors.input}}),e.addTo(graph),addElement(doubleClickedLink,e,"input")}function addAssignment(){const e=getRectangle();e.attr({label:{text:getWrapText("Statement")},body:{fill:blockColors.assignment}}),e.addTo(graph),addElement(doubleClickedLink,e,"assignment")}function addFunction(){const e=getRectangle();e.attr({label:{text:getWrapText("Function")},body:{fill:blockColors.function}}),e.addTo(graph),addElement(doubleClickedLink,e,"function")}function addComment(){const e=getRectangle();e.attr({label:{text:getWrapText("Comment")},body:{fill:blockColors.comment,strokeWidth:1,stroke:"#959595",strokeDasharray:"2,2"}}),e.addTo(graph),addElement(doubleClickedLink,e,"comment")}function addWhile(){const e=getHexagon();e.attr({label:{text:getWrapText("while")},body:{fill:blockColors.while}}),e.addTo(graph),addElementWhile(doubleClickedLink,e,"while")}function addForLoop(){const e=getHexagon();e.attr({label:{text:getWrapText("for")},body:{fill:blockColors.for}}),e.addTo(graph),addElementWhile(doubleClickedLink,e,"for")}function addDoWhileLoop(){const e=getHexagon();e.attr({label:{text:getWrapText("do-while")},body:{fill:blockColors.doWhile}}),e.addTo(graph),addElementDoWhile(doubleClickedLink,e)}function addDeclaration(){const e=getRectangle();e.attr({label:{text:getWrapText("Declare Variable")},body:{fill:blockColors.declaration}}),e.addTo(graph),addElement(doubleClickedLink,e,"declare")}function addIF(){const e=getDiamond();e.attr({label:{text:getWrapText("if")},body:{fill:blockColors.if}}),e.addTo(graph),addElementIf(doubleClickedLink,e,"if")}function scrollToBottom(){document.getElementById("message-to-send").scrollIntoView()}function renderUser(){scrollToBottom();const e=$textarea.val().trim();if(""!==e.trim()){const t=Handlebars.compile($("#message-template").html()),n={messageOutput:e};$chatHistoryList.append(t(n)),scrollToBottom(),$textarea.val("")}return e}function renderProgram(e){const t=Handlebars.compile($("#message-response-template").html()),n={response:e};this.$chatHistoryList.append(t(n)),this.scrollToBottom()}async function allowUser(){return scrollToBottom(),$textarea.prop("disabled",!1),new Promise((function(e,t){$button.one("click",(function(t){clearInterval(n),e(renderUser())}));let n=setInterval(()=>{stopped&&(e("Stopped"),$button.click(),clearInterval(n))},2e3)}))}function clearChat(){$chatHistoryList.html("")}function disableUser(){$textarea.prop("disabled",!0)}paper.on("link:pointerdblclick",(function(e){handleDoubleClick(e)})),$chatHistory=$(".chat-history"),$button=$("#chatsend"),$textarea=$("#message-to-send"),$chatHistoryList=$chatHistory.find("ul"),renderProgram("Start Flowgramming!"),disableUser();let indent="",originalIndent="",language="",error=!1,varArray={};function isArray(e){try{return 1!==e.split(" ").length||e.includes("array")||e.includes("[]")}catch(e){return!1}}function variableHelper(e,t=!1,n=""){let a=e.attr("element/variableName");if(""!==n&&(a=n),t||void 0===varArray[a]){let t=isArray(e.attr("element/variableType"))?e.attr("element/variableType").split(" ")[0]:e.attr("element/variableType");varArray[a]={name:a,type:t,length:e.attr("element/arrayLength"),colLen:e.attr("element/colLen"),is2DArray:e.attr("element/is2DArray"),isArray:e.attr("element/isArrayChecked"),rowLen:e.attr("element/rowLen")}}return varArray[a]}function declarationHelper(e){const t=e.attr("element/variableArray");return t?t.forEach(t=>{variableHelper(e,!0,t)}):variableHelper(e,!0,e.attr("element/variableName")),window[language+"Declaration"](variableHelper(e,!0))}function functionCallHelper(e){let t=e.attr("element/functionName"),n=e.attr("element/functionVariable");return{name:t,params:e.attr("element/functionParams"),returnVar:n,returnType:contexts[t].returnType,isArray:isArray(contexts[t].returnType),variable:varArray[n]}}function getLanguageExtension(){return{cpp:"cpp",python:"py",pseudo:"ps"}[language]}function getCode(){return{code:code,language:language}}function expressionHelper(e){let t=e.attr("element/expression");return varArray[t]?varArray[t]:{name:e.attr("element/expression")}}function assignmentHelper(e){let t=e.attr("element/variableName"),n={name:t,value:e.attr("element/variableValue")};if(isArrayNotation(t)){let e=t.split("[");varArray[e[0]]&&(n={...varArray[e[0]],...n,arrayNotation:e})}else varArray[t]&&(n={...n,...varArray[t]});return n}function booleanExpressionHelper(e){let t=indent,n=window[language+"IfBlock"](expressionHelper(e));if(""!==n){code+=indent+n.statement;let a=findModel(e.attr("outgoing_link/trueLink")),r=findModel(a.attr("element/target")),i=findModel(e.attr("outgoing_link/next")),l=findModel(i.attr("element/target")),o=findModel(e.attr("outgoing_link/falseLink")),s=findModel(o.attr("element/target"));indent+=n.indent,l!==r&&convertLoop(r,l),l!==s&&(code+=t+window[language+"BlockClose"](),code+=t+window[language+"ElseBlock"](),convertLoop(s,l)),indent=t,code+=indent+window[language+"IfClose"]()}}function LoopHelper(e){let t=findModel(e.attr("outgoing_link/loopLink")),n=findModel(t.attr("element/target"));e!==n&&convertLoop(n,e)}function whileLoopHelper(e){let t=indent,n=window[language+"WhileLoop"](expressionHelper(e));""!==n&&(code+=indent+n.statement,indent+=n.indent,LoopHelper(e),indent=t,code+=indent+window[language+"LoopClose"]())}function forLoopHelper(e){let t=indent,n=e.attr("element/forLoop");n={...n,expr:expressionHelper(e)},code+=indent+window[language+"ForLoop"](n).statement,indent+=window[language+"ForLoop"](n).indent,LoopHelper(e),indent=t,code+=indent+window[language+"LoopClose"]()}function doWhileLoopStartHelper(e){originalIndent=indent,code+=indent+window[language+"DoWhileLoopStart"]().statement,indent+=window[language+"DoWhileLoopStart"]().indent}function checkIfEmpty(e){switch(e.attr("element/type")){case"input":case"declare":case"assignment":if(!e.attr("element/variableName"))throw new Error("Variable name can't be empty");break;case"output":case"while":case"doWhileExpr":case"if":if(!e.attr("element/expression"))throw new Error("Expression can't be empty")}}function convertLoop(e,t=null){for(error=!1;;)try{switch(checkIfEmpty(e),e.attr("element/type")){case"input":code+=indent+window[language+"Input"](variableHelper(e),indent);break;case"output":code+=indent+window[language+"Output"](expressionHelper(e),indent);break;case"declare":code+=indent+declarationHelper(e);break;case"assignment":code+=indent+window[language+"Assignment"](assignmentHelper(e),indent);break;case"if":booleanExpressionHelper(e);break;case"while":switch(e.attr("element/loopType")){case"while":whileLoopHelper(e);break;case"for":forLoopHelper(e)}break;case"circle":"doWhile"===e.attr("element/circleType")&&doWhileLoopStartHelper(e);break;case"doWhileExpr":indent=originalIndent,code+=indent+window[language+"DoWhileLoopClose"](expressionHelper(e));break;case"function":code+=indent+window[language+"FunctionCall"](functionCallHelper(e),indent)}if(!e.attr("outgoing_link"))break;{let n;if(n=findModel(e.attr("outgoing_link/next")),(e=findModel(n.attr("element/target")))===t)break}}catch(e){error=!0,console.log(e),swal(e.message||e.toString());break}}function functionDefinitions(e){language=e,Object.keys(contexts).filter(e=>"main"!==e).forEach(async e=>{let t=contexts[e].parameters.slice();t.forEach((e,n)=>{t[n]={...e,isArray:isArray(e.variableType),variableType:e.variableType.split(" ")[0]}});let n={name:e,params:t,type:""===contexts[e].returnVariable?"void":contexts[e].returnType.split(" ")[0],isArray:isArray(contexts[e].returnType)};code+=window[language+"FunctionDefinition"](n),$("#currentContext").val(e),switchContext(),convertLoop(findModel(contexts[e].start.id)),code+=window[language+"FunctionClose"](contexts[e].returnVariable)}),$("#currentContext").val("main"),switchContext()}function convert(e="pseudo"){code=window[e+"Headers"](),functionDefinitions(e),code+=window[e+"FunctionDefinition"]({name:"main",type:"void",params:[]}),indent="","main"!==currentContextName&&($("#currentContext").val("main"),switchContext()),start=findModel(contexts[currentContextName].start.id),convertLoop(start,e),code+=window[e+"FunctionClose"](""),error||(openNewTab("code.html","CodeConverter"),hideLoader())}function cppIfBlock(e){return{statement:"\tif ("+e.name+") {\n",indent:"\t"}}function cppElseBlock(){return"\telse {\n"}function cppWhileLoop(e){return{statement:"\twhile ("+e.name+") {\n",indent:"\t"}}function cppDoWhileLoopStart(){return{statement:"\tdo { \n",indent:"\t"}}function cppDoWhileLoopClose(e){return(void 0===e||void 0===e.name)&&(e={name:"true"}),"\t} while ("+e.name+");\n"}function cppForLoop(e){return void 0===e.init&&(e.init=""),void 0===e.expr&&(e.expr={name:""}),void 0===e.incr&&(e.incr=""),void 0===e.type&&(e.type=""),{statement:"\tfor ("+e.type+e.init+"; "+e.expr.name+"; "+e.incr+") {\n",indent:"\t"}}function cppBlockClose(){return"\t}\n"}function cppLoopClose(){return cppBlockClose()}function cppIfClose(){return cppBlockClose()}function cppHandleArray(e){return cppForLoop({init:"i=0",expr:{name:"i<"+e.length},incr:"i++",type:"int "}).statement}function cppInput(e,t){return void 0!==e.name?e.isArray&&"Char"!==e.type?cppHandleArray(e)+t+"\t\tcin >> "+e.name+"[i];\n"+t+cppBlockClose():"\tcin >> "+e.name+";\n":""}function cppGetType(e){return{Integer:"int",Char:"char",Float:"float",void:"void"}[(e=e.split(" "))[0]]}function cppDeclaration(e){let t=cppGetType(e.type);if(""!==t&&void 0!==e.name){if(e.isArray){let n=e.name.split(","),a="\t"+t+" ";return n.forEach(t=>{e.is2DArray?a+=t+"["+e.rowLen+"]["+e.colLen+"], ":a+=t+"["+e.length+"], "}),a.slice(0,-2)+";\n"}return"\t"+t+" "+e.name+";\n"}return""}function cppOutput(e,t){return void 0!==e?e.isArray&&"Char"!==e.type?cppHandleArray(e)+t+"\t\tcout << "+e.name+"[i];\n"+t+cppBlockClose():"\tcout << "+e.name+";\n":""}function addQuotes(e,t="'"){let n=e;return'"'===e.charAt(0)&&"'"===e.charAt(0)||(n=t+e),'"'===e.charAt(e.length-1)&&"'"===e.charAt(e.length-1)||(n+=t),e.charAt(0)!==e.charAt(e.length-1)&&(n[0]=n[e.length-1]=t),n}function cppAssignment(e,t){if(void 0!==e.value){let n=e.value.split(",");if("Char"!==e.type&&void 0!==e.type||(void 0!==e.arrayNotation?e.value=addQuotes(e.value):1===n.length?e.value=addQuotes(n[0],'"'):n.forEach((e,t)=>{n[t]=addQuotes(e)})),void 0!==e.name){if(void 0===e.arrayNotation&&e.isArray&&("Char"===e.type&&n.length>1||"Char"!==e.type)){let a="";return t+="\t",n.forEach((n,r)=>a+=t+e.name+"["+r+"] = "+n+";\n"),a}return"\t"+e.name+" = "+e.value+";\n"}}return""}function cppFunctionCall(e,t){return""!==e.returnVar?e.isArray&&"char"!==e.returnType?void 0===e.variable||void 0===e.variable.length?"\t"+e.returnType+" "+e.returnVar+"[] = "+e.name+" ("+e.params+");\n":"\t"+e.returnType+" temp = "+e.name+" ("+e.params+");\n"+t+cppHandleArray(e.variable)+t+"\t\t"+e.returnVar+"[i] = temp[i];\n"+t+"\t}\n":"\t"+e.returnVar+" = "+e.name+" ("+e.params+");\n":"\t"+e.name+" ("+e.params+");\n"}function cppHeaders(){return"#include <iostream>\n#include <string>\nusing namespace std;\n"}function cppFunctionClose(e){return""!==e?"\treturn "+e+"; \n}\n":"}\n"}function cppFunctionDefinition(e){let t="";e.params.forEach(e=>{t+=cppGetType(e.variableType)+" "+e.variableName,e.isArray?t+="[], ":t+=", "}),t=t.slice(0,-2);let n=e.type;return e.isArray?n+="[] ":n+=" ",n+=e.name+"("+t+") {\n",n}function translateUp(e,t,n,a=!1){let r=n.position(),i=e.position(),l=-100;for(a&&(l=-300);e!==t&&r.x===i.x;)if(e.translate(0,l),"if"===e.attr("element/type")&&translateIF(e),e.attr("outgoing_link/next")){const t=findModel(e.attr("outgoing_link/next")),n=t.vertices();"ifEnd"===t.attr("element/type")&&t.vertices([{x:n[0].x,y:n[0].y-100}]),i=(e=findModel(t.attr("element/target"))).position()}else e=null}function findPrevLink(e){return graph.attributes.cells.models.filter(t=>t.attr("element/target")==e)[0]}function findNextLink(e){return graph.attributes.cells.models.filter(t=>t.attr("element/source")==e)[0]}function makeLinks(e,t,n,a){var r=new joint.shapes.standard.Link;r.source(e),r.target(t),r.addTo(graph),r.attr({element:{target:t.id,source:e.id,type:n.attr("element/type")}});const i=e.position();switch("circle"!==t.attr("element/type")&&"true"!==n.attr("element/falselink")||(r.vertices([{x:i.x+75,y:t.position().y+25}]),r.attr({element:{type:"if"}})),"ifEnd"===a.attr("element/type")&&r.attr({element:{type:"ifEnd"}}),a.attr("element/type")){case"whileEnd":r.vertices([...r.vertices(),{x:i.x-100,y:i.y+30}]),r.attr({element:{type:"whileEnd"}});break;case"ifEnd":let e=a.vertices()[0].x;r.vertices([...r.vertices(),{x:e,y:t.position().y+25}]),r.attr({element:{type:"ifEnd",falseLink:"false"}})}switch(n.attr("element/type")){case"ifStart":r.attr({element:{type:"ifStart"}}),"true"===n.attr("element/falselink")?(r.vertices([{x:i.x-100,y:i.y+50},{x:i.x-100,y:t.position().y+25}]),r.appendLabel({attrs:{text:{text:"False"}},position:{distance:.1}}),r.attr({element:{type:"if",falselink:"true"}}),e.attr({outgoing_link:{...e.attr("outgoing_link"),falseLink:r.id}})):(r.vertices([{x:i.x+200,y:i.y+50},{x:i.x+200,y:t.position().y+25}]),r.appendLabel({attrs:{text:{text:"True"}},position:{distance:.1}}),r.attr({element:{type:"if",falselink:"false"}}),e.attr({outgoing_link:{...e.attr("outgoing_link"),trueLink:r.id}}));break;case"whileStart":"whileEnd"===a.attr("element/type")?r.vertices([{x:i.x+350,y:i.y+37.5},{x:i.x+350,y:i.y+150},{x:i.x+150,y:i.y+150}]):r.vertices([{x:i.x+350,y:i.y+31.5},{x:i.x+350,y:i.y+150}]),r.appendLabel({attrs:{text:{text:"True"}},position:{distance:.1}}),r.attr({element:{type:"whileStart"}}),e.attr({outgoing_link:{...e.attr("outgoing_link"),loopLink:r.id}});break;case"doWhileStart":"doWhileEnd"===a.attr("element/type")&&r.vertices([{x:i.x+350,y:i.y+37.5},{x:i.x+350,y:i.y+150},{x:i.x+150,y:i.y+150}]);default:e.attr({outgoing_link:{...e.attr("outgoing_link"),next:r.id}})}}function deleteBlock(e){let t=findPrevLink(e.id),n=findNextLink(e.id),a=findModel(n.attr("element/target")),r=findModel(t.attr("element/source"));if("declare"===e.attr("element/type")){let t=e.attr("element/variableArray");if(t.length>1)for(let e=0;e<t.length;e++)delete variables[t[e]];else delete variables[e.attr("element/variableName")];updateVariablesInWatchWindow()}translateUp(a,null,e),makeLinks(r,a,t,n),t.remove(),n.remove(),e.remove()}function checkNested(e,t){let n=!1;for(;e!==t;){let t=findModel(findNextLink(e.id).attr("element/target"));if("if"===e.attr("element/type")||"while"===e.attr("element/type")||"doWhileExpr"===e.attr("element/type")){n=!0;break}e=t}return n}function deleteIF(e){nextLink=findNextLink(e.id),currentEnd=findModel(nextLink.attr("element/target"));let t=findModel(e.attr("outgoing_link/trueLink")),n=findModel(t.attr("element/target")),a=currentEnd,r=findModel(e.attr("outgoing_link/falseLink")),i=findModel(r.attr("element/target"));if(checkNested(n,a)||checkNested(i,a))throw new Error("Delete the nested component first!");for(;n!==a;){let e=findModel(findNextLink(n.id).attr("element/target"));deleteBlock(n),n=e}for(;i!==a;){let e=findModel(findNextLink(i.id).attr("element/target"));deleteBlock(i),i=e}deleteBlock(currentEnd),deleteBlock(e),t.remove(),r.remove()}function deleteWhile(e){let t=findModel(e.attr("outgoing_link/loopLink")),n=findModel(t.attr("element/target"));if(checkNested(n,e))throw new Error("Delete the nested component first!");for(;n!==e;){let e=findModel(findNextLink(n.id).attr("element/target"));deleteBlock(n),n=e}t.remove(),prevLink=findPrevLink(e.id),nextLink=findModel(e.attr("outgoing_link/next")),circle=findModel(nextLink.attr("element/target")),nextLink=findModel(circle.attr("outgoing_link/next")),currentEnd=findModel(nextLink.attr("element/target")),newStart=findModel(prevLink.attr("element/source")),translateUp(currentEnd,null,e,!0),makeLinks(newStart,currentEnd,prevLink,nextLink),circle.remove(),e.remove()}function getCurrentElementValue(e,t){let n=void 0;switch(t){case"input":n=e.attr("element/variableName");break;case"output":case"comment":case"if":case"doWhileExpr":case"while":if("for"!==e.attr("element/loopType"))n=e.attr("element/expression");else{const{forLoop:t,expression:a}=e.attr("element");n={forLoop:t,expression:a}}break;case"declare":case"assignment":case"function":n=e.attr("element")}return n||""}function shouldSelectDataType(e,t){return"Default"===t?e.variableType&&"Default"!==e.variableType?"":"selected":e.variableType&&e.variableType.startsWith(t)?"selected":""}function shouldMarkArrayCheckbox(e){return e.variableType&&e.variableType.endsWith("array")?"checked":""}function onArrayCheckboxChanged(){$("#isArray").is(":checked")?($("#arrayDimension").show(),onArrayDimensionChanged()):$("#arrayDimension").hide()}function shouldMarkArray2D(e){return e.is2DArray?"checked":""}function shouldMarkArray1D(e){return e.is2DArray?"":"checked"}function onArrayDimensionChanged(){"1D"===$("input[name='dimension']:checked").val()?($("#arrayLength").show(),$("#array2D").hide()):($("#arrayLength").hide(),$("#array2D").show())}function handleElementDoubleClick(e){const t=findModel(e.model.id);$("#delbtn").text("Delete").attr("onclick","handleDelete()"),$("#modal .modal-content").attr("data-element",JSON.stringify(t));const n=t.attr("element/type"),a=getCurrentElementValue(t,n);let r,i;switch(n){case"declare":i=`\n                    <p>Enter Variable Name and Type</p>\n                     <div class="input-group">\n                        <input id="variable" type="text" class="form-control" placeholder="Name"\n                                value="${a.variableName||""}">\n                        <select class="custom-select" id="variableType">\n                            <option value="Default" ${shouldSelectDataType(a,"Default")} disabled>\n                                Type\n                            </option>\n                            <option value="Integer" ${shouldSelectDataType(a,"Integer")}>\n                                Integer\n                            </option>\n                            <option value="Float" ${shouldSelectDataType(a,"Float")}>\n                                Float\n                            </option>\n                            <option value="Char" ${shouldSelectDataType(a,"Char")}>\n                                Character\n                            </option>\n                        </select>\n                    </div>\n                    <hr>\n                    <div class="form-check ml-1 mt-1">\n                      <input class="form-check-input" type="checkbox" id="isArray" \n                            ${shouldMarkArrayCheckbox(a)} onclick="onArrayCheckboxChanged()">\n                      <label class="form-check-label" for="isArray">\n                        Is an array\n                      </label>\n                    </div>\n                    <div id='arrayDimension'>\n                        <div class="form-check" >\n                            <div class="form-check form-check-inline">\n                              <input class="form-check-input" type="radio" id="1D" value='1D' name='dimension' ${shouldMarkArray1D(a)} onchange="onArrayDimensionChanged()">\n                              <label class="form-check-label" for="1D">1D</label>\n                            </div>\n                            <div class="form-check form-check-inline">\n                              <input class="form-check-input" type="radio" name='dimension' value='2D' id="2D" ${shouldMarkArray2D(a)} onchange='onArrayDimensionChanged()'>\n                              <label class="form-check-label" for="2D">2D</label>\n                            </div>\n                        </div>\n                        <div class="input-group mt-2" >\n                            <input id="arrayLength" type="number" class="form-control" placeholder="Array length"\n                                        value="${a.arrayLength||""}" min="1">\n                        </div>  \n                        <div class="input-group mt-2" id='array2D'>\n                            <input id="arrayRow" type="number" class="form-control" placeholder="Rows"\n                                        value="${a.rowLen||""}" min="1">\n                            <input id="arrayCol" type="number" class="form-control" placeholder="Columns"\n                                        value="${a.colLen||""}" min="1">\n                        </div>   \n                    </div> \n            `,r=function(){const e=$("#variable").val();let n=$("#variableType option:selected").val(),a=$("#arrayLength").val(),r=$("#arrayRow").val(),i=$("#arrayCol").val();if($("#modal").modal("hide"),e.length<=0)swal("Enter the variable name before declaring it");else if("Default"===n)swal("Enter the variable type before declaring it");else if($("#isArray").is(":checked")&&"1D"===$("input[name='dimension']:checked").val()&&(0===parseInt(a)||isNaN(parseInt(a))))swal("The array length should be declared");else if($("#isArray").is(":checked")&&"2D"===$("input[name='dimension']:checked").val()&&(0===parseInt(r)||isNaN(parseInt(r))||isNaN(parseInt(i))||0===parseInt(i)))swal("The number of rows and columns should be declared");else if(r.includes(".")||i.includes(".")||a.includes("."))swal("Array sizes must only be natural numbers");else{const l=$("#isArray").is(":checked"),o="2D"===$("input[name='dimension']:checked").val();n+=l?" array":"";let s=n+" ";variableArray=e.split(",");let d=!0;for(let e=0;e<variableArray.length&&(d=d&&handleNamingConvention(variableArray[e]),d);e++);d&&(l?o?(variableArray.forEach(e=>{s+=`${e}[${r}][${i}], `}),a=""):(variableArray.forEach(e=>{s+=`${e}[${a}], `}),r=i=""):variableArray.forEach(e=>{s+=e+", "}),t.attr({label:{text:getWrapText(s.slice(0,-2))},element:{variableName:e,variableArray:variableArray,variableType:n,is2DArray:o,rowLen:r,colLen:i,arrayLength:a,isArrayChecked:l}}))}};break;case"input":i=`\n                <p>Enter Variable Name</p>\n                <div class="input-group">\n                    <input id="variable" type="text" class="form-control"\n                            value="${escapeQuotes(a)}">\n                </div>\n            `,r=function(){const e=$("#variable").val();$("#modal").modal("hide"),e.length>0?t.attr({label:{text:getWrapText("Input "+e)},element:{variableName:e}}):swal("Enter input variable name")};break;case"comment":i=`\n                    <p>Enter the comment</p>\n                    <div class="input-group">\n                        <input id="exp" type="text" class="form-control"\n                                value="${escapeQuotes(a)}">\n                    </div>\n                `,r=function(){const e=$("#exp").val();$("#modal").modal("hide"),e.length>0?t.attr({label:{text:getWrapText(e)},element:{expression:e}}):swal("Enter the comment")};break;case"output":case"if":case"doWhileExpr":case"while":"for"!==t.attr("element/loopType")?(i=`\n                    <p>Enter the expression</p>\n                    <div class="input-group">\n                        <input id="exp" type="text" class="form-control"\n                                value="${escapeQuotes(a)}">\n                    </div>\n                `,r=function(){const e=$("#exp").val();$("#modal").modal("hide"),e.length>0?t.attr({label:{text:getWrapText(("output"===n?"Print ":"")+e)},element:{expression:e}}):swal("Enter the expression")}):(i=`\n                      <p>Enter expressions below</p>\n                      <hr>\n                      <div class="form-group">\n                        <label for="initialisation">Initialisation</label>\n                        <input type="text" placeholder="Ex: counter = 1" class="form-control" id="initialisation"\n                            value="${a.forLoop&&escapeQuotes(a.forLoop.init)||""}">\n                      </div>\n                      <div class="form-group">\n                        <label for="condition">Condition</label>\n                        <input type="text" placeholder="Ex: counter < value" class="form-control" id="condition"\n                            value="${a.expression?escapeQuotes(a.expression):""}">\n                      </div>\n                      <div class="form-group">\n                        <label for="incrementation">Incrementation</label>\n                        <input type="text" placeholder="Ex: counter = counter * 2" class="form-control" id="incrementation"\n                            value="${a.forLoop&&escapeQuotes(a.forLoop.incr)||""}">\n                      </div>\n                `,r=function(){const e=$("#initialisation").val(),n=$("#condition").val(),a=$("#incrementation").val();$("#modal").modal("hide"),0===e.length?swal("Enter initial value"):0===n.length?swal("Enter the condition"):0===a.length?swal("Increment the variable"):t.attr({label:{text:getWrapText(`${e}; ${n}; ${a}`)},element:{expression:n,forLoop:{init:e,incr:a}}})});break;case"assignment":i=`\n                <p>Select a variable and enter the value</p>\n                <div class="input-group mb-3">\n                  <input type="text" id="variableName" class="form-control" placeholder="Variable name"\n                    value="${a.variableName?escapeQuotes(a.variableName):""}">\n                  <input type="text" id="variableValue" class="form-control" placeholder="Variable value"\n                    value="${a.variableName?escapeQuotes(a.variableValue):""}">\n                </div>\n            `,r=function(){const e=$("#variableValue").val(),n=$("#variableName").val();$("#modal").modal("hide"),n.length<=0?swal("Enter the variable name"):e.length<=0?swal("Enter variable value"):t.attr({label:{text:getWrapText(n+" = "+e)},element:{variableName:n,variableValue:e}})};break;case"function":i=`\n                <p>Function call</p>\n                <div class="input-group mb-3">\n                  <input type="text" id="functionName" class="form-control" placeholder="Function name"\n                    value="${a.functionName?escapeQuotes(a.functionName):""}">\n                </div>\n                <div class="input-group mb-3">\n                  <input type="text" id="functionParams" class="form-control" placeholder="Comma separated parameters"\n                    value="${a.functionParams?escapeQuotes(a.functionParams):""}">\n                </div>\n                <div class="input-group">\n                  <input type="text" id="functionVariable" class="form-control" placeholder="Variable for return value"\n                    value="${a.functionVariable?escapeQuotes(a.functionVariable):""}">\n                </div>\n            `,r=function(){const e=$("#functionParams").val(),n=$("#functionName").val(),a=$("#functionVariable").val();$("#modal").modal("hide"),n.length<=0?swal("Enter the function name"):t.attr({label:{text:getWrapText((a?a+" = ":"")+`${n}(${e})`)},element:{functionName:n,functionParams:e,functionVariable:a}})}}$("#modal .modal-body").html(i),$("#modal").modal("show"),$("#okButton").one("click",r),$("#xbtn").on("click",(function(){$("#okButton").off("click")})),$("#isArray").ready(onArrayCheckboxChanged)}function handleNamingConvention(e,t="Variable"){return new RegExp("^[a-zA-Z_][a-zA-Z0-9_]*$").test(e)?!["int","float","string","array","char","if","else","while","for","switch","case","default","break","continue","auto","const","let","var","do","foreach","enum","long","register","return","short","signed","sizeof","static","struct","typedef","union","unsigned","void","volatile","new","throw","catch","printf","scanf","print","cin","cout","scanner","list","in","true","false","null","None","not"].includes(e)||(swal(t+" name must not be a keyword"),!1):(swal("Follow naming convention <br> <hr>"+t+" name should start only either with an underscore or an alphabet. It should not start with number or any other special symbols <hr>Other characters apart from first character can be alphabets, numbers or _ character <hr>"+t+" name should not contain space <br>"),!1)}function handleDelete(){try{let e=$("#modal .modal-content").attr("data-element");if(e&&(e=findModel(JSON.parse(e).id)),"if"===e.attr("element/type"))deleteIF(e);else if("while"===e.attr("element/type"))deleteWhile(e);else{if("doWhileExpr"===e.attr("element/type"))throw new Error("DoWhile Block can't be deleted");deleteBlock(e)}}catch(e){swal(e.toString())}}function pseudoIfBlock(e){return{statement:"\tif ("+e.name+") \n",indent:"\t"}}function pseudoElseBlock(){return"\telse \n"}function pseudoWhileLoop(e){return{statement:"\twhile ("+e.name+")\n",indent:"\t"}}function pseudoDoWhileLoopStart(){return{statement:"\tdo\n",indent:"\t"}}function pseudoDoWhileLoopClose(e){return(void 0===e||void 0===e.name)&&(e={name:"true"}),"\twhile ("+e.name+");\n\tendLoop\n"}function pseudoForLoop(e){return void 0===e.init&&(e.init=""),void 0===e.expr&&(e.expr={name:""}),void 0===e.incr&&(e.incr=""),void 0===e.type&&(e.type=""),{statement:"\tfor ("+e.type+e.init+"; "+e.expr.name+"; "+e.incr+") \n",indent:"\t"}}function pseudoBlockClose(){return"\n"}function pseudoLoopClose(){return"\tendLoop\n"}function pseudoIfClose(){return"\tendIf\n"}function pseudoInput(e,t){return void 0!==e.name?"\tinput ("+e.name+")\n":""}function pseudoDeclaration(e){return cppDeclaration(e).slice(0,-2)+"\n"}function pseudoOutput(e,t){return void 0!==e?"\tprint ("+e.name+")\n":""}function pseudoAssignment(e,t){return void 0!==e.value?"\t"+e.name+" = "+e.value+"\n":""}function pseudoFunctionCall(e,t){return""!==e.returnVar?"\t"+e.returnVar+" = call "+e.name+" ("+e.params+")\n":"\t call "+e.name+" ("+e.params+")\n"}function pseudoHeaders(){return""}function pseudoFunctionClose(e){return""!==e?"\treturn "+e+" \nendFn\n":"endFn\n"}function pseudoFunctionDefinition(e){return"startFn\n"+cppFunctionDefinition(e).slice(0,-2)+"\n"}let strokeLow={width:0,color:"black"};const strokeHigh={width:5,color:"#E74C3C"};let visitedItems=new Set;const stringManipulationRegex=/(([a-zA-Z]+)|([a-zA-Z]+\.[a-zA-Z]+))\(([a-zA-Z0-9]|,|]|\[|')+\)/,mathFunctionRegex=/\b(abs|pow|ln|sqrt|log|sgn|ceil|floor|round|sin|cos|tan|arcsin|arccos|arctan)\b/,speedToDelayMapping={slow:1500,medium:1e3,undefined:1e3,fast:500};let paused=!1,stopped=!1,variablesStack=[],previousContextStack=[],previousContextModelStack=[],visitedItemsStack=[],functionReturnVariablesStack=[];function sleep(e){return new Promise(t=>setTimeout(t,e))}async function delayLoop(e){for(;;){const t=speedToDelayMapping[speedOfExecutionDropdown.val()];strokeLow.width=e.attr("body/strokeWidth"),e.attr("body/strokeWidth",strokeHigh.width),e.attr("body/fill")!==strokeHigh.color&&e.attr("body/stroke",strokeHigh.color);let n=!1;try{switch(e.attr("element/type")){case"input":await handleInput(e);break;case"output":await handleOutput(e);break;case"if":case"doWhileExpr":n=await handleBooleanExpression(e);break;case"while":switch(e.attr("element/loopType")){case"while":n=await handleBooleanExpression(e);break;case"for":n=await handleForLoop(e)}break;case"declare":await handleDeclaration(e);break;case"assignment":await handleAssignment(e)}for(visitedItems.add(e.id),n||visitedItems.delete(e.id),updateVariablesInWatchWindow(),await sleep(t);paused&&(e.attr("body/fill")!==strokeHigh.color&&e.attr("body/stroke",strokeHigh.color),!stopped);)await sleep(10);if(e.attr("body/strokeWidth",strokeLow.width),e.attr("body/stroke",strokeLow.color),stopped)break;if("end"===e.attr("element/type")&&previousContextStack.length){let t;if(e=previousContextModelStack.pop(),functionReturnVariablesStack.length){const{value:e,type:n}=variables[contexts[currentContextName].returnVariable];if(t=e,n!==contexts[currentContextName].returnType)throw new Error("Return type does not match the returned variable's type")}if(variables={...variablesStack.pop()},Object.keys(variables).forEach(e=>{let t=variables[e].value;t?(t=Array.isArray(t)?JSON.stringify(t).slice(1,-1):t.toString(),handleAssignmentHelper(e,t)):handleNullAssignment(e,variables[e].type)}),visitedItems=new Set(visitedItemsStack.pop()),previousContextStack[previousContextStack.length-1]!==currentContextName?($("#currentContext").val(previousContextStack.pop()),switchContext()):previousContextStack.pop(),functionReturnVariablesStack.length){handleAssignmentHelper(functionReturnVariablesStack.pop(),Array.isArray(t)?JSON.stringify(t).slice(1,-1):t.toString())}continue}if("function"===e.attr("element/type")){const t=e.attr("element/functionName"),n=e.attr("element/functionVariable"),a=e.attr("element/functionParams");n&&functionReturnVariablesStack.push(n);let r,i=new Map;if(a){r={...variables};const e=contexts[t].parameters.length,n=contexts[t].parameters,l=a.split(",");for(let t=0;t<e;++t)l[t].includes("[")?i.set(n[t].variableName,handleArrayAssignment(l[t])):i.set(n[t].variableName,l[t])}variablesStack.push({...variables}),visitedItemsStack.push(new Set(visitedItems)),previousContextStack.push(currentContextName);const l=findModel(e.attr("outgoing_link/next"));previousContextModelStack.push(findModel(l.attr("element/target"))),variables=[],visitedItems.clear(),currentContextName!==t&&($("#currentContext").val(t),switchContext()),a&&contexts[t].parameters.forEach(e=>{let t;if(void 0!==r[i.get(e.variableName)]){let n=r[i.get(e.variableName)];t=n.value,handleDeclarationHelper(e.variableName,e.variableType,n.arrayLength,n.rowLen,n.colLen,n.is2DArray)}else t=globalEval(i.get(e.variableName)),handleDeclarationHelper(e.variableName,e.variableType);t=Array.isArray(t)?JSON.stringify(t).slice(1,-1):t.toString(),handleAssignmentHelper(e.variableName,t)}),e=findModel(contexts[t].start.id);continue}if(!e.attr("outgoing_link"))break;{let t;const a=e.attr("element/type");t=["if","while","doWhileExpr"].includes(a)?getConditionalNextLink(e,a,n):findModel(e.attr("outgoing_link/next")),e=findModel(t.attr("element/target"))}}catch(t){swal(t.message||t.toString()),e.attr("body/strokeWidth",strokeLow.width),e.attr("body/stroke",strokeLow.color),e=null;break}}}function getConditionalNextLink(e,t,n){return findModel(e.attr({if:["outgoing_link/falseLink","outgoing_link/trueLink"],while:["outgoing_link/next","outgoing_link/loopLink"],doWhileExpr:["outgoing_link/next","outgoing_link/loopLink"]}[t][Number(n)]))}async function handleDeclaration(e){let t=e.attr("element/variableArray"),n=e.attr("element/variableType"),a=e.attr("element/arrayLength"),r=e.attr("element/rowLen"),i=e.attr("element/colLen"),l=e.attr("element/is2DArray");if(t.length>1)for(let e=0;e<t.length;e++)handleDeclarationHelper(t[e],n,a,r,i,l);else handleDeclarationHelper(e.attr("element/variableName"),n,a,r,i,l)}function initializeArray(e){let t=[];for(let n=0;n<e;n++)t.push("N/A");return t}function handleDeclarationHelper(e,t,n,a,r,i){if(variables[e])throw new Error("Variable with the same name is already declared");t.includes("[]")&&(i=!0,t=t.slice(0,-3));const l={Integer:"int",Float:"float",Char:"char","Integer array":"int(array)","Float array":"float(array)","Char array":"char(array)"}[t];if(l.includes("array")){let t=[];if(i)for(let e=0;e<a;e++){let e=initializeArray(r);t.push(e)}else t=initializeArray(n);variables[e]={type:l,value:t,arrayLength:n,rowLen:a,colLen:r,is2DArray:i}}else variables[e]={type:l,value:null}}async function handleAssignment(e){return handleAssignmentHelper(e.attr("element/variableName"),e.attr("element/variableValue")),{status:"Ok"}}function handleNullAssignment(e,t){variables[e]={type:t,value:null}}function handleAssignmentHelper(e,t){let n;if(!e)throw new Error("Assign a variable name");if(!t)throw new Error("Assign a variable value");isArrayNotation(e)&&(n=e.split("["));let{type:a,arrayLength:r,rowLen:i,colLen:l,is2DArray:o}=getDeclaredVariable(e,n);handleRuntimeErrors(t);try{if("int"===a){if(isArrayNotation(t)){let n=handleArrayAssignment(t,a);globalEval(e+" = "+n),t=n}else mathFunctionRegex.test(t)&&(t=parseInt(mathFunctions(e,t)));stringManipulationRegex.test(t)?t=stringManipulations(e,t):(t=parseInt(globalEval(t)),globalEval(e+" = "+t))}else if("float"===a)if(isArrayNotation(t)){let n=handleArrayAssignment(t,a);globalEval(e+" = "+n)}else mathFunctionRegex.test(t)?t=parseFloat(mathFunctions(e,t)):stringManipulationRegex.test(t)?t=stringManipulations(e,t):(t=parseFloat(globalEval(t)),globalEval(e+" = "+t));else if("char"===a)if(stringManipulationRegex.test(t))t=stringManipulations(e,t);else{if(!isChar(t))throw new Error("Datatype mismatch");globalEval(e+" = '"+t+"'")}else"int(array)"===a?t=handleArrays(t,isInteger,parseInt,e,"integer",!1,r,i,l,o):"float(array)"===a?t=handleArrays(t,isFloat,parseFloat,e,"float",!1,r,i,l,o):"char(array)"===a&&(t=handleArrays(t,isChar,parseChar,e,"character",!1,r,i,l,o));storeVariables(e,n,t,a)}catch(e){handleNotInitializedVariables(e)}}async function handleInput(e){let t,n;const a=e.attr("element/variableName");if(!a)throw new Error("Assign a variable name to take input");isArrayNotation(a)&&(n=a.split("["));let{type:r,arrayLength:i,rowLen:l,colLen:o,is2DArray:s}=getDeclaredVariable(a,n);if(isArrayNotation(a)){if(n.length>2&&globalEval(n[2].slice(0,-1))>=o)throw new Error("The specified number of columns of the array ("+o+") cannot hold these many values");if(s&&globalEval(n[1].slice(0,-1))>=l)throw new Error("The specified number of rows of the array ("+l+") cannot hold these many values");if(!s&&globalEval(n[1].slice(0,-1))>=i)throw new Error("The specified length of the array ("+i+") cannot hold these many values");n.length>2?renderProgram("Enter the value for variable "+n[0]+"["+globalEval(n[1].slice(0,-1))+"]["+globalEval(n[2].slice(0,-1))+"]"):renderProgram("Enter the value for variable "+n[0]+"["+globalEval(n[1].slice(0,-1))+"]")}else renderProgram("Enter the value for variable "+a);const d=await allowUser();if("Stopped"!==d){if("int"===r&&!0===isInteger(d))t=parseInt(d),globalEval(a+" = "+t);else if("float"===r&&!0===isFloat(d))t=parseFloat(d),globalEval(a+" = "+t);else if("char"===r&&isChar(d))t=d,globalEval(a+" = '"+d+"'");else if("int(array)"===r)t=handleArrays(d,isInteger,parseInt,a,"integer",!0,i,l,o,s);else if("float(array)"===r)t=handleArrays(d,isFloat,parseFloat,a,"float",!0,i,l,o,s);else{if("char(array)"!==r)throw new Error("Data type mismatch\n\nDeclared variable is of type "+r);t=handleArrays(d,isChar,parseChar,a,"character",!0,i,l,o,s)}return storeVariables(a,n,t,r),{status:"Ok"}}}function twoDArrayToString(e){let t="";for(let n=0;n<e.length;n++)t+="["+e[n]+"],";return t.slice(0,-1)}async function handleOutput(e){if(!e.attr("element/expression"))throw new Error("Assign a Expression");handleRuntimeErrors(e.attr("element/expression"));try{let t=e.attr("element/expression");if(isArrayNotation(t)){let e,n=t.split("["),a=globalEval(n[1].split("]")[0]);if(variables[n[0]].is2DArray){if(variables[n[0]].rowLen&&a>=variables[n[0]].rowLen)throw new Error("The specified row ("+a+") doesn't exist in the array")}else if(variables[n[0]].arrayLength&&a>=variables[n[0]].arrayLength)throw new Error(" The specified length of array ("+variables[n[0]].arrayLength+") cannot hold these many values");if(e=variables[n[0]].value[a],n.length>2){let t=globalEval(n[2].split("]")[0]);if(variables[n[0]].colLen&&t>=variables[n[0]].colLen)throw new Error("The specified column ("+t+") doesn't exist in the array");e=variables[n[0]].value[a][t]}renderProgram(e||"N/A")}else if(t in variables){t=variables[t];let e=t.value;t.is2DArray&&(e=twoDArrayToString(e)),renderProgram(e)}else renderProgram(globalEval(t))}catch(e){handleNotInitializedVariables(e)}return{status:"Ok"}}async function handleForLoop(e){try{const t=e.attr("element/forLoop/incr");if(visitedItems.has(e.id)){if(!t)throw new Error("Enter the incrementation expression");handleRuntimeErrors(t);let e=t.match(/[a-zA-z]*/)[0];e in variables&&(globalEval(t),variables[e].value=parseInt(globalEval(e)))}else{const t=e.attr("element/forLoop/init");if(!t)throw new Error("Enter the initialisation expression");let n=t.split("=")[0].trim();n in variables&&(variables[n].value=globalEval(t))}}catch(e){handleNotInitializedVariables(e)}return handleBooleanExpression(e)}async function handleBooleanExpression(e){if(!e.attr("element/expression"))throw new Error("Assign a Expression");handleRuntimeErrors(e.attr("element/expression"));try{return!!globalEval(e.attr("element/expression"))}catch(e){handleNotInitializedVariables(e)}}function clearAll(){visitedItems.clear(),variables=[],variablesStack=[],visitedItemsStack=[],previousContextStack=[],previousContextModelStack=[],"main"!==currentContextName&&($("#currentContext").val("main"),switchContext()),start=findModel(contexts[currentContextName].start.id),clearChat()}async function run(){clearAll(),stopped=!1,paused=!1,await delayLoop(start),$("#stop-btn").addClass("hidden"),$("#pause-btn").addClass("hidden"),$("#run-btn").removeClass("hidden")}async function pause(){paused=!0,$("#pause-btn").addClass("hidden"),$("#play-btn").removeClass("hidden")}async function play(){paused=!1,$("#play-btn").addClass("hidden"),$("#pause-btn").removeClass("hidden")}async function stopRun(){stopped=!0,clearAll(),updateVariablesInWatchWindow(),$("#stop-btn").addClass("hidden"),$("#pause-btn").addClass("hidden"),$("#play-btn").addClass("hidden"),$("#run-btn").removeClass("hidden")}function isFloat(e){return!(isNaN(parseFloat(e))||!isFinite(e))&&!!e.includes(".")}function isInteger(e){return!(isNaN(parseFloat(e))||!isFinite(e))&&!e.toString().includes(".")}function isChar(e){return 1===e.length}function parseChar(e){return'"'===e[0]&&'"'===e[e.length-1]&&(e=e.slice(1,-1)),"'"+e+"'"}function isArrayNotation(e){return!(!e.includes("[")||!e.includes("]"))}function getDeclaredVariable(e,t){let n;if(isArrayNotation(e)){if(!((t=e.split("["))[0]in variables))throw new Error("Declare the variable "+t[0]+" before using it");n=variables[t[0]]}else{if(!(e in variables))throw new Error("Declare the variable "+e+" before using it");n=variables[e]}return n}function storeVariables(e,t,n,a){if(isArrayNotation(e)){variables[t[0]].type=a;let e=t[1].split("]")[0];if(isInteger(e)||(e=globalEval(e)),t.length>2){let a=t[2].split("]")[0];isInteger(a)||(a=globalEval(a)),variables[t[0]].value[parseInt(e)]?variables[t[0]].value[parseInt(e)].length<variables[t[0]].colLen&&(variables[t[0]].value[parseInt(e)]=[...variables[t[0]].value[parseInt(e)],...initializeArray(variables[t[0]].colLen-variables[t[0]].value[parseInt(e)].length)]):variables[t[0]].value[parseInt(e)]=initializeArray(variables[t[0]].colLen),variables[t[0]].value[parseInt(e)][parseInt(a)]=n}else!variables[t[0]].is2DArray&&variables[t[0]].value.length<variables[t[0]].arrayLength&&(variables[t[0]].value=[...variables[t[0]].value,...initializeArray(variables[t[0]].arrayLength-variables[t[0]].value.length)]),variables[t[0]].value[parseInt(e)]=n}else variables[e]={...variables[e],type:a,value:n}}function handleArrayAssignment(e,t){try{if("character"===t)return isArrayNotation(e)?globalEval(e):e;var n=e.split("[")[0];if(operators=["+","-","*","/","%"],operators.forEach(e=>{n.includes(e)&&(n=n.split(e)[1])}),n.includes("+")&&(n=n.split("+")[1]),isArrayNotation(e)&&n in variables){let t,n=!1;if(operators.forEach(a=>{if(e.includes(a)){let o=e.split("[")[0];var r,i=e.split(a)[0],l=e.split(a)[1];i.includes("[")?(o=i,r=l):(o=l,r=i);let s=globalEval(o.split("[")[1][0]);if(t=variables[o.split("[")[0]].value[s],e.split("[").length>2){let n=globalEval(e.split("]")[2]);t=variables[o.split("[")[0]].value[s][n]}t=globalEval(r+a+t),n=!0}}),n)return t;{let n=e.split("["),a=globalEval(n[1].split("]")[0]);if(t=variables[n[0]].value[a],n.length>2){let e=globalEval(n[2].split("]")[0]);t=variables[n[0]].value[a][e]}return t}}return globalEval(e).toString()}catch(e){console.log(e),handleNotInitializedVariables(e)}}function removeQuotes(e){if(e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"'))return e.slice(1,-1)}function handle1Darrays(e,t,n,a,r){if("character"===e&&-1===t.search(",")){let e=[...t];("'"==e[0]&&"'"==e[e.length-1]||'"'==e[0]&&'"'==e[e.length-1])&&(e.pop(),e.shift(),t=e.toString())}let i=t.split(",");for(let t=0;t<i.length;t++)if(i[t].includes("N/A")&&(i[t]=removeQuotes(i[t])),n(i[t]))i[t]=r(i[t]);else{if("N/A"!==i[t]&&"N/A"!==i[t].replace(/^'+|'+$/g,"")&&"N/A"!==i[t].replace(/^"+|"+$/g,""))throw new Error("Data type mismatch\n\nDeclared array "+a+" is of type "+e+" but value at position "+(t+1)+" in the array is not of type "+e);i[t]=i[t].replace(/^"+|"+$/g,""),i[t]="'"+i[t].replace(/^'+|'+$/g,"")+"'"}return i}function handleArrays(e,t,n,a,r,i,l,o,s,d){let c;try{let p=a.split("[");if(isArrayNotation(a)){if(stringManipulationRegex.test(e))return c=stringManipulations(a,e),c;let l;if(d&&parseInt(p[1].split("]")[0])>=parseInt(o))throw new Error("The specified length of array ("+o+") cannot hold these many values");if(d&&p.length<3)c=handle1Darrays(r,e,t,a,n);else{if(d&&e.includes(","))throw new Error("Array can't be assigned to "+r.split(" ")[0]);if(d&&parseInt(p[2].split("]")[0])>=parseInt(s))throw new Error("The specified number of columns of the array ("+s+") cannot hold these many values");if(i)l=t(e),c=n(e);else{l=t(handleArrayAssignment(e,r)),c=n(handleArrayAssignment(e,r))}if(!l)throw new Error("Data type mismatch\n\nDeclared array is of type "+r);globalEval(p[0]+"="+c)}}else{if(stringManipulationRegex.test(e))return c=stringManipulations(a,e),c;if(d&&!e.includes(";")&&(e=e.replaceAll("],","];")),d&&"character"===r&&!e.includes(";")&&(e=e.replaceAll(",",";")),c=e.split(";"),d)for(let e=0;e<c.length;e++){let i=c[e];if("["!==i[0]&&"("!==i[0]&&"{"!==i[0]||"]"!==i[i.length-1]&&")"!==i[i.length-1]&&"}"!==i[i.length-1]||(i=c[e].slice(1,-1)),i=handle1Darrays(r,i,t,a,n),i.length>parseInt(s))throw new Error("The specified number of columns ("+s+") of the array cannot hold these many values");c[e]=i}else c=handle1Darrays(r,e,t,a,n);globalEval(a+"=["+c+"]")}if(!d&&c.length>parseInt(l))throw new Error(" The specified length of array ("+l+") cannot hold these many values");if(d&&c.length>parseInt(o)&&!isArrayNotation(a))throw new Error(" The specified length of array ("+o+") cannot hold these many values");return c}catch(e){handleNotInitializedVariables(e)}}function handleNotInitializedVariables(e){const t=e.message;if(e instanceof ReferenceError){const e=t.split(" ");if(variables[e[0]])throw new Error(e[0]+" is not initialised.\n\nInitialize the variable before using it");throw new Error(e[0]+" is not defined.\n\nDefine the variable before using it")}if(e instanceof TypeError)throw new Error("Undefined variable is used");throw t||e.toString()}function handleRuntimeErrors(e){if(-1!==e.search(/[/][\s]*[0]/))throw new Error("Variable divided by zero")}function isString(e){return!(!e.startsWith("'")&&!e.startsWith('"'))||(e=globalEval(e),Array.isArray(e)?"string"==typeof e[0]||isNaN(e.join(""))&&isNaN(parseFloat(e.join(""))):isNaN(e)||isNaN(parseFloat(e)))}function stringManipulations(e,t){let n=/\(([^)]+)\)/.exec(t);if(t.includes("strcat")){let t=n[1].split(","),a=t[0],r=t[1];if(!isString(a)||!isString(r))throw new Error("Both parameters have to be of type character to concatenate");return Array.isArray(globalEval(r))||(r=JSON.stringify(globalEval(r).split(""))),Array.isArray(globalEval(a))||(a=JSON.stringify(globalEval(a).split(""))),globalEval(e+"= "+a+".concat("+r+")")}if(t.includes("substr"))return t=t.replace("substr","slice"),globalEval(e+"="+t);if(t.includes("strcmp")){let t=n[1].split(","),a=globalEval(t[0]),r=globalEval(t[1]);return Array.isArray(a)&&(a=a.join("")),Array.isArray(r)&&(r=r.join("")),console.log(JSON.stringify(a),JSON.stringify(r)),JSON.stringify(a)===JSON.stringify(r)?(globalEval(e+"=0"),0):(globalEval(e+"="+-1),-1)}if(t.includes("strlen")){let t=n[1];return globalEval(""===e?t+".length":e+"="+t+".length")}if(t.includes("toAscii")){let t=n[1];return globalEval(e+"="+t+".codePointAt(0)")}if(t.includes("toChar")){let t=n[1];return globalEval(e+"= String.fromCharCode("+t+")")}if(t.includes("toUpperCase")){let t=n[1];return isArrayNotation(t)||"char"===variables[t].type?globalEval(e+"="+t+".toUpperCase()"):globalEval(e+"="+t+".map("+t+" => "+t+".toUpperCase())")}if(t.includes("toLowerCase")){let t=n[1];return isArrayNotation(t)||"char"===variables[t].type?globalEval(e+"="+t+".toLowerCase()"):globalEval(e+"="+t+".map("+t+" => "+t+".toLowerCase())")}}function mathFunctions(e,t){let n=/\(([^)]+)\)/.exec(t);if(t.includes("abs")){let t=parseInt(globalEval(n[1]));return globalEval(e+"=Math.abs("+t+")")}if(t.includes("sqrt")){let t=parseInt(globalEval(n[1]));return globalEval(e+"=Math.sqrt("+t+")")}if(t.includes("sgn")){let t=parseInt(globalEval(n[1]));return globalEval(e+"=Math.sign("+t+")")}if(t.includes("pow")){let t=n[1].split(","),a=parseInt(globalEval(t[0])),r=parseInt(globalEval(t[1]));return globalEval(e+"=Math.pow("+a+","+r+")")}if(t.includes("ln")){let t=parseInt(globalEval(n[1]));return globalEval(e+"=Math.log("+t+")")}if(t.includes("log")){let t=n[1].split(","),a=parseInt(globalEval(t[0])),r=parseInt(globalEval(t[1]));return globalEval(10===a?e+"=Math.log("+r+") / Math.LN10":e+"=Math.log("+r+") / Math.log("+a+")")}if(t.includes("sin")){let t=parseFloat(globalEval(n[1]));return globalEval(e+"=Math.sin("+t+"*(Math.PI/180))")}if(t.includes("cos")){let t=parseFloat(globalEval(n[1]));return globalEval(e+"=Math.cos("+t+"*(Math.PI/180))")}if(t.includes("tan")){let t=parseFloat(globalEval(n[1]));return globalEval(e+"=Math.tan("+t+"*(Math.PI/180))")}if(t.includes("arcsin")){let t=parseFloat(globalEval(n[1]));return globalEval(e+"=Math.asin("+t+")")}if(t.includes("arccos")){let t=parseFloat(globalEval(n[1]));return globalEval(e+"=Math.acos("+t+")")}if(t.includes("arctan")){let t=parseFloat(globalEval(n[1]));return globalEval(e+"=Math.atan("+t+")")}if(t.includes("ceil")){let t=parseFloat(globalEval(n[1]));return globalEval(e+"=Math.ceil("+t+")")}if(t.includes("floor")){let t=parseFloat(globalEval(n[1]));return globalEval(e+"=Math.floor("+t+")")}if(t.includes("round")){let t=n[1].split(","),a=parseFloat(globalEval(t[0]));if(t.length>1){let n=parseInt(globalEval(t[1]));return globalEval(e+"="+a.toFixed(n))}return globalEval(e+"=Math.round("+a+")")}}const signingKey="Flowgramming",fnSigningKey="FlowgrammingFunction";function saveFlowChart(){switchContext();saveFile("Untitled.fgmin",JSON.stringify(JSON.decycle({signingKey:signingKey,contexts:contexts})))}function downloadFunction(e){window.opener.switchContext();const t=e+".fgfn";if(e in window.opener.getCurrentContexts()){let n={[e]:window.opener.getCurrentContexts()[e]};saveFn(t,JSON.stringify(JSON.decycle({signingKey:fnSigningKey,contexts:n})),"save-"+e)}}function saveFn(e,t,n="save-btn"){showProgress("Downloading","Please wait while your function is downloaded");const a=new Blob([t],{type:"application/json;charset=utf-8"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(a,e),hideLoader();else{const t=document.getElementById(n);t.href=URL.createObjectURL(a),t.download=e,hideLoader()}}function importFlowGram(e){try{const t=JSON.retrocycle(JSON.parse(e));if(t.signingKey!==signingKey)return void swal("Flowgramming doesn't support that file!");contexts=t.contexts,currentContextName="main",graph.fromJSON(contexts[currentContextName].graph),paper.fitToContent({padding:20,minWidth:paperColumn.width(),minHeight:paperColumn.height(),gridWidth:10,gridHeight:10}),start=findModel(contexts[currentContextName].start.id),updateContextsDropdown()}catch(e){swal("Something went wrong!")}finally{clearChat(),renderProgram("Start Flowgramming!"),hideLoader()}}function importFunction(e){try{const t=JSON.retrocycle(JSON.parse(e));if(t.signingKey!==fnSigningKey)return void swal("Not a flowgramming function!");Object.keys(t.contexts).forEach(e=>{addFunctionToTable(e)}),parentWindowContexts={...parentWindowContexts,...t.contexts},window.opener.addNewContext(t.contexts)}catch(e){swal("Something went wrong!")}finally{hideLoader()}}function openFromFile(e,t=!1){showLoader("Importing","Please wait while your flowgram is imported"),setTimeout(()=>{t?importFunction(e):importFlowGram(e)},1e3)}const capitalize=e=>e.charAt(0).toUpperCase()+e.slice(1);window.swal=(e,t="error")=>{var n;Swal.fire({title:(n=t,n.charAt(0).toUpperCase()+n.slice(1)),html:e,icon:t,heightAuto:!1})},window.swalConfirm=(e,t)=>{Swal.fire({title:"Are you sure?",html:e,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, do it!",heightAuto:!1}).then(e=>{e.isConfirmed&&t()})},window.toast=e=>{Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0,icon:"success",title:e,didOpen:e=>{e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}}).fire()};let loadingToast=null;function openNewTab(e,t){return window.open(e,t)}function getParallelogram(){const e=new joint.shapes.standard.Path;return e.resize(150,75),e.attr("root/title","joint.shapes.standard.Path"),e.attr("body/refD","M 21 1 L 197 0 L 173 69 L 0 69 Z"),e}function getDiamond(){const e=new joint.shapes.standard.Path;return e.resize(100,100),e.attr("body/refD","M 30 0 L 60 30 30 60 0 30 Z"),e}function getHexagon(){const e=new joint.shapes.standard.Path;return e.resize(150,75),e.attr("body/refD","M 100 30 L 0 30 L -25 67 L 0 105 L 100 105 L 125 67 L 100 30 Z"),e}function getRectangle(){const e=new joint.shapes.standard.Rectangle;return e.resize(150,75),e}function getWrapText(e){return joint.util.breakText(e,{width:120,height:70},{},{ellipsis:!0})}function getCircle(){const e=new joint.shapes.standard.Circle;return e.resize(25,50),e.attr("body/fill","lightblue"),e}function addElement(e,t,n){let a,r,i;const l=e.vertices();i=findModel(e.attr("element/target")),r=findModel(e.attr("element/source"));const o=r.attr("element/type");if(null==e.attr("element/type")){const l=r.position();"circle"===o?t.position(l.x-60,l.y+100):"while"===o?t.position(l.x+30,l.y+100):"doWhileExpr"===o?t.position(l.x,l.y+150):t.position(l.x,l.y+100),e.set({target:t}),e.attr("element/target",t.id),a=new joint.shapes.standard.Link,t.attr({element:{type:n},outgoing_link:{next:a.id}}),a.source(t),a.target(i),a.addTo(graph),a.attr({element:{target:i.id,source:t.id}}),translateDown(i,null)}else if("if"===e.attr("element/type")){l[0].y>l[1].y&&swap(l[0],l[1]),e.attr("element/type","ifStart"),i=findModel(e.attr("element/target")),r=findModel(e.attr("element/source"));const o=r.position();o.x<=l[0].x?o.x+=125:o.x-=175,t.position(o.x,o.y+100),e.set({target:t}),e.attr("element/target",t.id),a=new joint.shapes.standard.Link,a.vertices([{x:l[1].x,y:l[1].y+100}]),t.attr({element:{type:n},outgoing_link:{next:a.id}}),a.source(t),a.target(i),a.addTo(graph),a.attr({element:{target:i.id,source:t.id,type:"ifEnd"}}),e.vertices([l[0]]),translateDown(i,null)}else if("doWhile"===e.attr("element/type")){l[0].y>l[1].y&&swap(l[0],l[1]),e.attr("element/type","doWhileStart"),i=findModel(e.attr("element/target")),r=findModel(e.attr("element/source"));const o=r.position();o.x<=l[0].x?o.x+=125:o.x-=175,t.position(o.x,o.y+100),e.set({target:t}),e.attr("element/target",t.id),a=new joint.shapes.standard.Link,a.vertices([{x:l[1].x,y:l[1].y+100}]),t.attr({element:{type:n},outgoing_link:{next:a.id}}),a.source(t),a.target(i),a.addTo(graph),a.attr({element:{target:i.id,source:t.id,type:"doWhileEnd"}}),e.vertices([l[0]]),translateDown(i,null)}else if("while"===e.attr("element/type")){l[0].y>l[1].y&&swap(l[0],l[1]),e.attr("element/type","whileStart"),i=findModel(e.attr("element/target")),r=findModel(e.attr("element/source"));const s=r.position();s.x<=l[0].x?s.x+=225:s.x-=175,"circle"===o?t.position(s.x-60,s.y+100):t.position(s.x,s.y+100),e.set({target:t}),e.attr("element/target",t.id),a=new joint.shapes.standard.Link,a.vertices([{x:l[1].x,y:l[1].y+100},{x:l[1].x-200,y:l[1].y+100}]),t.attr({element:{type:n},outgoing_link:{next:a.id}}),a.source(t),a.target(i,{anchor:{name:"bottomRight",args:{dx:-50}}}),a.addTo(graph),a.attr({element:{target:i.id,source:t.id,type:"whileEnd"}}),e.vertices([l[0]]),translateDown(findModel(findModel(i.attr("outgoing_link/next")).attr("element/target")),null)}else if(["ifStart","whileStart","doWhileStart"].includes(e.attr("element/type"))){i=findModel(e.attr("element/target")),r=findModel(e.attr("element/source"));const o=r.position();o.x<=l[0].x?o.x+=175:o.x-=150,"whileStart"===e.attr("element/type")?o.x+=50:"doWhileStart"===e.attr("element/type")&&(o.x-=50),t.position(o.x,o.y+100),e.set({target:t}),e.attr("element/target",t.id),a=new joint.shapes.standard.Link,t.attr({element:{type:n},outgoing_link:{next:a.id}}),a.source(t),a.target(i),a.addTo(graph),a.attr({element:{target:i.id,source:t.id}}),translateDown(i,null)}else if(["ifEnd","whileEnd","doWhileEnd"].includes(e.attr("element/type"))){e.vertices([]),i=findModel(e.attr("element/target")),r=findModel(e.attr("element/source"));const s=r.position();t.position(s.x,s.y+100),e.set({target:t}),e.attr("element/target",t.id),a=new joint.shapes.standard.Link,a.source(t),"circle"===o?t.position(s.x-60,s.y+100):"while"===o?t.position(s.x+30,s.y+100):t.position(s.x,s.y+100),"whileEnd"===e.attr("element/type")?(a.vertices([{x:l[0].x,y:l[0].y+100},{x:l[1].x,y:l[1].y+100}]),a.target(i,{anchor:{name:"bottomRight",args:{dx:-50}}}),t.attr({element:{type:n},outgoing_link:{next:a.id}}),a.addTo(graph),a.attr({element:{target:i.id,source:t.id,type:e.attr("element/type")}}),e.attr("element/type",null),translateDown(findModel(findModel(i.attr("outgoing_link/next")).attr("element/target")),null)):("doWhileEnd"===e.attr("element/type")?a.vertices([{x:t.position().x+75,y:t.position().y+187.5}]):a.vertices([{x:t.position().x,y:t.position().y+100}]),a.target(i),t.attr({element:{type:n},outgoing_link:{next:a.id}}),a.addTo(graph),a.attr({element:{target:i.id,source:t.id,type:e.attr("element/type")}}),e.attr("element/type",null),translateDown(i,null))}}function addElementDoWhile(e,t){const n=e.vertices();2===n.length&&n[0].y>n[1].y&&swap(n[0],n[1]);const a=findModel(e.attr("element/target"));let r=findModel(e.attr("element/source"));const i=r.attr("element/type"),l=r.position();["if","ifStart"].includes(e.attr("element/type"))?l.x<=n[0].x?l.x+=125:l.x-=175:["while","whileStart"].includes(e.attr("element/type"))?l.x+=225:["doWhile","doWhileStart"].includes(e.attr("element/type"))&&(l.x+=187.5);const o=getCircle();o.addTo(graph),"circle"===i?(o.position(l.x,l.y+100),t.position(l.x-62,l.y+200)):(o.position(l.x+62,l.y+100),t.position(l.x,l.y+250)),e.set({target:o}),e.attr("element/target",o.id);const s=new joint.shapes.standard.Link;s.source(t),s.target(o),s.addTo(graph),s.appendLabel({attrs:{text:{text:"True"}},position:{distance:.2},trueLink:"True"}),s.attr({element:{target:o.id,source:t.id,type:"doWhileTrue"}});const d=o.position(),c=new joint.shapes.standard.Link;c.vertices([{x:d.x+200,y:d.y+25},{x:d.x+200,y:t.position().y+38.5}]),c.source(o),c.target(t),c.addTo(graph),c.attr({element:{target:t.id,source:o.id,type:"doWhile"}});const p=new joint.shapes.standard.Link;p.source(t),p.target(a),p.appendLabel({attrs:{text:{text:"False"}},position:{distance:.18}}),p.addTo(graph),t.attr({element:{type:"doWhileExpr"},outgoing_link:{next:p.id,loopLink:s.id}});const u=new joint.shapes.standard.Link;u.source(o),u.target(t),u.addTo(graph),u.attr("./display","none"),u.attr({element:{target:t.id,source:o.id}});const g=e.attr("element/type");["if","doWhile"].includes(g)?(e.attr({element:{type:g+"Start"}}),"doWhile"===g?p.vertices([{x:t.position().x+75,y:n[1].y+300}]):p.vertices([{x:n[1].x,y:n[1].y+100}]),p.attr({element:{target:a.id,source:t.id,type:g+"End"}}),e.vertices([n[0]]),translateDown(a,null),translateDown(a,null),translateDown(a,null)):["ifEnd","doWhileEnd"].includes(g)?(e.vertices([]),p.vertices([{x:n[0].x,y:n[0].y+("doWhileEnd"===g?300:100)}]),e.attr("element/type",null),p.attr({element:{target:a.id,source:t.id,type:g}}),translateDown(a,null),translateDown(a,null),translateDown(a,null)):"whileEnd"===g?(e.vertices([]),p.vertices([{x:n[0].x,y:t.position().y+175},{x:n[1].x,y:t.position().y+175}]),p.target(a,{anchor:{name:"bottomRight",args:{dx:-50}}}),e.attr("element/type",null),p.attr({element:{target:a.id,source:t.id,type:"whileEnd"}}),translateDown(findModel(findModel(a.attr("outgoing_link/next")).attr("element/target")),null),translateDown(findModel(findModel(a.attr("outgoing_link/next")).attr("element/target")),null),translateDown(findModel(findModel(a.attr("outgoing_link/next")).attr("element/target")),null)):"while"===g?(p.target(a,{anchor:{name:"bottomRight",args:{dx:-50}}}),e.attr({element:{type:"whileStart"}}),p.attr({element:{target:a.id,source:t.id,type:"whileEnd"}}),p.vertices([{x:n[1].x,y:t.position().y+100},{x:n[2].x,y:t.position().y+100}]),e.vertices([n[0]]),translateDown(findModel(findModel(a.attr("outgoing_link/next")).attr("element/target")),null),translateDown(findModel(findModel(a.attr("outgoing_link/next")).attr("element/target")),null)):(p.attr({element:{target:a.id,source:t.id}}),translateDown(a,null),translateDown(a,null),translateDown(a,null)),o.attr({element:{type:"circle",circleType:"doWhile"},outgoing_link:{next:c.id,invisibleLink:u.id}})}function addElementWhile(e,t,n){const a=e.vertices(),r=findModel(e.attr("element/target"));let i=findModel(e.attr("element/source"));const l=i.attr("element/type"),o=i.position();["if","ifStart"].includes(e.attr("element/type"))?o.x<=a[0].x?o.x+=125:o.x-=175:["while","whileStart"].includes(e.attr("element/type"))?o.x+=225:["doWhile","doWhileStart"].includes(e.attr("element/type"))&&(o.x+=187.5),e.set({target:t}),e.attr("element/target",t.id);const s=getCircle();s.addTo(graph),"circle"===l?(t.position(o.x-62,o.y+100),s.position(o.x,o.y+300)):(t.position(o.x,o.y+150),s.position(o.x+62,o.y+300));const d=t.position(),c=new joint.shapes.standard.Link;c.vertices([{x:d.x+300,y:d.y+37.5},{x:d.x+300,y:d.y+120},{x:d.x+100,y:d.y+120}]),c.source(t),c.target(t,{anchor:{name:"bottomRight",args:{dx:-50}}}),c.addTo(graph),c.appendLabel({attrs:{text:{text:"True"}},position:{distance:.1}}),c.attr({element:{target:t.id,source:t.id,type:"while"}});const p=new joint.shapes.standard.Link,u=new joint.shapes.standard.Link;u.source(t),u.target(s),u.addTo(graph),u.appendLabel({attrs:{text:{text:"False"}},position:{distance:.2}}),p.source(s),p.target(r),p.addTo(graph);let g=!1;"doWhile"===e.attr("element/type")?(e.attr({element:{type:"doWhileStart"}}),p.vertices([{x:a[1].x,y:a[1].y+300}]),p.attr({element:{target:r.id,source:s.id,type:"doWhileEnd"}}),e.vertices([a[0]])):"doWhileEnd"===e.attr("element/type")?(e.vertices([]),p.vertices([{x:a[0].x,y:a[0].y+300}]),e.attr("element/type",null),p.attr({element:{target:r.id,source:s.id,type:"doWhileEnd"}})):"if"===e.attr("element/type")?(e.attr({element:{type:"ifStart"}}),p.vertices([{x:a[1].x,y:a[1].y+175}]),p.attr({element:{target:r.id,source:s.id,type:"ifEnd"}}),e.vertices([a[0]])):"ifEnd"===e.attr("element/type")?(e.vertices([]),p.vertices([{x:a[0].x,y:a[0].y+175}]),e.attr("element/type",null),p.attr({element:{target:r.id,source:s.id,type:"ifEnd"}})):"whileEnd"===e.attr("element/type")?(e.vertices([]),p.vertices([{x:a[0].x,y:s.position().y+100},{x:a[1].x,y:s.position().y+100}]),p.target(r,{anchor:{name:"bottomRight",args:{dx:-50}}}),e.attr("element/type",null),p.attr({element:{target:r.id,source:s.id,type:"whileEnd"}}),g=!0):"while"===e.attr("element/type")?(p.target(r,{anchor:{name:"bottomRight",args:{dx:-50}}}),e.attr({element:{type:"whileStart"}}),p.vertices([{x:a[1].x,y:s.position().y+100},{x:a[2].x,y:s.position().y+100}]),p.attr({element:{target:r.id,source:s.id,type:"whileEnd"}}),e.vertices([a[0]]),g=!0):p.attr({element:{target:r.id,source:s.id}}),u.attr({element:{target:s.id,source:t.id,type:"whileFalse"}}),s.attr({element:{type:"circle"},outgoing_link:{next:p.id}}),t.attr({element:{type:"while",loopType:n},outgoing_link:{next:u.id,loopLink:c.id}}),g?(translateDown(findModel(findModel(r.attr("outgoing_link/next")).attr("element/target")),null),translateDown(findModel(findModel(r.attr("outgoing_link/next")).attr("element/target")),null),translateDown(findModel(findModel(r.attr("outgoing_link/next")).attr("element/target")),null)):(translateDown(r,null),translateDown(r,null),translateDown(r,null))}function addElementIf(e,t,n){const a=e.vertices();2===a.length&&a[0].y>a[1].y&&swap(a[0],a[1]);const r=findModel(e.attr("element/target"));let i=findModel(e.attr("element/source"));const l=i.attr("element/type"),o=i.position();["if","ifStart"].includes(e.attr("element/type"))?o.x<=a[0].x?o.x+=125:o.x-=175:["while","whileStart"].includes(e.attr("element/type"))?o.x+=225:["doWhile","doWhileStart"].includes(e.attr("element/type"))&&(o.x+=187.5),e.set({target:t}),e.attr("element/target",t.id);const s=getCircle();s.addTo(graph),"circle"===l?(t.position(o.x-37.5,o.y+100),s.position(o.x,o.y+200)):"doWhileExpr"===l?(t.position(o.x+25,o.y+125),s.position(o.x+60,o.y+225)):(t.position(o.x+25,o.y+100),s.position(o.x+60,o.y+200));const d=new joint.shapes.standard.Link;d.source(t),d.target(s),d.addTo(graph),d.attr("./display","none"),d.attr({element:{target:s.id,source:t.id}});const c=t.position(),p=new joint.shapes.standard.Link;p.vertices([{x:c.x+200,y:c.y+50},{x:c.x+200,y:s.position().y+25}]),p.source(t),p.target(s),p.addTo(graph),p.appendLabel({attrs:{text:{text:"True"}},position:{distance:.1}}),p.attr({element:{target:s.id,source:t.id,type:"if",trueLink:"true"}});const u=new joint.shapes.standard.Link;u.vertices([{x:c.x-100,y:c.y+50},{x:c.x-100,y:s.position().y+25}]),u.source(t),u.target(s),u.addTo(graph),u.appendLabel({attrs:{text:{text:"False"}},position:{distance:.1}}),u.attr({element:{target:s.id,source:t.id,type:"if",falselink:"true"}}),t.attr({element:{type:n},outgoing_link:{next:d.id,trueLink:p.id,falseLink:u.id}});const g=new joint.shapes.standard.Link;g.source(s),g.target(r),g.addTo(graph),"doWhile"===e.attr("element/type")?(e.attr({element:{type:"doWhileStart"}}),g.vertices([{x:a[1].x,y:a[1].y+300}]),g.attr({element:{target:r.id,source:s.id,type:"doWhileEnd"}}),e.vertices([a[0]]),translateDown(r,null)):"doWhileEnd"===e.attr("element/type")?(e.vertices([]),g.vertices([{x:a[0].x,y:a[0].y+200}]),e.attr("element/type",null),g.attr({element:{target:r.id,source:s.id,type:"doWhileEnd"}}),translateDown(r,null),translateDown(r,null)):"if"===e.attr("element/type")?(e.attr({element:{type:"ifStart"}}),g.vertices([{x:a[1].x,y:a[1].y+100}]),g.attr({element:{target:r.id,source:s.id,type:"ifEnd"}}),e.vertices([a[0]]),translateDown(r,null),translateDown(r,null)):"ifEnd"===e.attr("element/type")?(e.vertices([]),g.vertices([{x:a[0].x,y:a[0].y+100}]),e.attr("element/type",null),g.attr({element:{target:r.id,source:s.id,type:"ifEnd"}}),translateDown(r,null),translateDown(r,null)):"whileEnd"===e.attr("element/type")?(e.vertices([]),g.vertices([{x:a[0].x,y:a[0].y+175},{x:a[1].x,y:a[1].y+175}]),g.target(r,{anchor:{name:"bottomRight",args:{dx:-50}}}),e.attr("element/type",null),g.attr({element:{target:r.id,source:s.id,type:"whileEnd"}}),translateDown(findModel(findModel(r.attr("outgoing_link/next")).attr("element/target")),null),translateDown(findModel(findModel(r.attr("outgoing_link/next")).attr("element/target")),null)):"while"===e.attr("element/type")?(g.target(r,{anchor:{name:"bottomRight",args:{dx:-50}}}),e.attr({element:{type:"whileStart"}}),g.vertices([{x:a[1].x,y:a[1].y+175},{x:a[2].x,y:a[2].y+175}]),g.attr({element:{target:r.id,source:s.id,type:"whileEnd"}}),e.vertices([a[0]]),translateDown(findModel(findModel(r.attr("outgoing_link/next")).attr("element/target")),null),translateDown(findModel(findModel(r.attr("outgoing_link/next")).attr("element/target")),null)):(g.attr({element:{target:r.id,source:s.id}}),translateDown(r,null),translateDown(r,null)),s.attr({element:{type:"circle"},outgoing_link:{next:g.id}}),setListener(s,"circle"),setListener(t,"if")}function translateWhile(e){const t=findModel(e.attr("outgoing_link/loopLink")),n=t.vertices(),a=[];e.id===t.attr("element/target")?(a.push({x:n[0].x,y:n[0].y+100}),a.push({x:n[1].x,y:n[1].y+100}),a.push({x:n[2].x,y:n[2].y+100}),t.vertices(a)):(a.push({x:n[0].x,y:n[0].y+100}),t.vertices(a),translateDown(findModel(t.attr("element/target")),e))}function translateDoWhile(e){const t=findModel(e.attr("outgoing_link/next")),n=findModel(e.attr("outgoing_link/invisibleLink"));if(n.attr("element/target")===t.attr("element/target")){const e=t.vertices(),n=[];n.push({x:e[0].x,y:e[0].y+100}),n.push({x:e[1].x,y:e[1].y+100}),t.vertices(n)}else{const e=t.vertices(),a=[];a.push({x:e[0].x,y:e[0].y+100}),t.vertices(a),translateDown(findModel(t.attr("element/target")),findModel(n.attr("element/target")))}}function translateIF(e){const t=findModel(e.attr("outgoing_link/next")),n=findModel(e.attr("outgoing_link/trueLink")),a=findModel(e.attr("outgoing_link/falseLink"));if(t.attr("element/target")===n.attr("element/target")){const e=n.vertices(),t=[];t.push({x:e[0].x,y:e[0].y+100}),t.push({x:e[1].x,y:e[1].y+100}),n.vertices(t)}else{const e=n.vertices(),a=[];a.push({x:e[0].x,y:e[0].y+100}),n.vertices(a),translateDown(findModel(n.attr("element/target")),findModel(t.attr("element/target")))}if(t.attr("element/target")===a.attr("element/target")){const e=a.vertices(),t=[];t.push({x:e[0].x,y:e[0].y+100}),t.push({x:e[1].x,y:e[1].y+100}),a.vertices(t)}else{const e=a.vertices(),n=[];n.push({x:e[0].x,y:e[0].y+100}),a.vertices(n),translateDown(findModel(a.attr("element/target")),findModel(t.attr("element/target")))}}function translateDown(e,t){let n;for(;e!==t;){if("while"!==e.attr("element/type")||!n||!["while","whileEnd"].includes(n.attr("element/type"))){e.translate(0,100);const t={if:translateIF,while:translateWhile,doWhile:translateDoWhile},n=e.attr("element/type"),a=e.attr("element/circleType"),r=t[n]||t[a];r&&r(e)}if(e.attr("outgoing_link")){switch(n="doWhile"===e.attr("element/circleType")?findModel(e.attr("outgoing_link/invisibleLink")):findModel(e.attr("outgoing_link/next")),n.attr("element/type")){case"ifEnd":case"doWhileEnd":const e=n.vertices();n.vertices([{x:e[0].x,y:e[0].y+100}]);break;case"whileEnd":const t=n.vertices();n.vertices([{x:t[0].x,y:t[0].y+100},{x:t[1].x,y:t[1].y+100}])}e=findModel(n.attr("element/target"))}else e=null}}function findModel(e){return graph.attributes.cells.models.find(t=>t.id===e)}function escapeQuotes(e){return String(e).replace(/"/g,"&quot;")}function setListener(e,t){"circle"===t&&e.on("change:position",(function(e,t){graph.attributes.cells.models.filter(t=>t.attr("element/target")===e.id).forEach(e=>{if(e.attr("element/type")){const n=e.vertices();2===n.length?(n[0].y>n[1].y&&swap(n[0],n[1]),n[1].y=t.y+25,t.x>n[1].x?n[1].x=t.x-140:n[1].x=t.x+160):n.length>0&&(t.x>n[0].x?n[0].x=t.x-140:n[0].x=t.x+160,n[0].y=t.y+25),e.vertices(n)}})}))}function updateVariablesInWatchWindow(){$("#variable-watch-body tr").remove(),$("#variable-watch-body").append(getHTMLForVariableWatchWindow())}function getHTMLForVariableWatchWindow(){let e="";return Object.keys(variables).forEach(t=>{let n=variables[t].value;const a=variables[t].type;variables[t].is2DArray&&(n=twoDArrayToString(n)),0!==n&&(n=n||"N/A"),e+=`<tr class="${getTableRowClassForVariableType(a)}"><td>${t}</td><td>${n}</td></tr>`}),e}function getTableRowClassForVariableType(e){switch(e.split("(")[0]){case"int":return"table-primary";case"float":return"table-danger";case"char":return"table-warning"}}window.showLoader=(e,t)=>{loadingToast=Swal.fire({heightAuto:!1,html:`\n            <div class="p-4">\n                <div class="loader"></div>\n                <h2><b>${e}</b></h2>\n                <p>${t}</p>\n            </div>`,showConfirmButton:!1})},window.showProgress=(e,t)=>{loadingToast=Swal.fire({heightAuto:!1,html:`\n            <div class="p-4">\n                <h2><b>${e}</b></h2>\n                <p>${t}</p>\n                <div class="progress hide" id="progress_bar">\n                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;">\n                    </div>\n                </div>\n                <p id="progress_res"></p>\n            </div>`,showConfirmButton:!1})},window.hideLoader=()=>{loadingToast&&(loadingToast.close(),loadingToast=null)},preventIndependentOpen=()=>{"localhost"===window.location.hostname||window.opener||(window.location.href="/")};